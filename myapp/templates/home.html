<!DOCTYPE html>
<html>
<head>
    <title>Sequence List</title>
    <script>
        // Function to search and navigate with query parameter
        function searchSequence() {
            const query = document.getElementById('search').value;
            if (query) {
                window.location.href = `?q=${query}`;
            }
        }

        // Function to create the heatmap for a sequence
        function createHeatmap(sequence, variants) {
            const sequenceContainer = document.createElement('p');
            for (let i = 0; i < sequence.length; i++) {
                const span = document.createElement('span');

                // If the current index has a variant, highlight it
                if (i in variants) {
                    span.className = 'variant';   // Style as variant (red)
                    span.innerHTML = variants[i].join(""); // Show the variant character at this position
                } else {
                    span.className = 'normal';    // Style as normal (black)
                    span.innerHTML = sequence[i]; // Show the original sequence character
                }

                sequenceContainer.appendChild(span);
            }
            return sequenceContainer;
        }

        // Function to render the list of sequences dynamically with heatmaps
        function renderSequenceList() {
            const sequences = JSON.parse('{{ sequence_json|escapejs }}');  // Rendered from Django context
            const seqList = document.getElementById('sequence-list');

            if (sequences.length > 0) {
                seqList.innerHTML = '';  // Clear previous results
                sequences.forEach(function(sequence) {
                    // Create a header for each sequence
                    const individual_id = document.createElement('h3');
                    individual_id.textContent = `Individual: ${sequence.Individual}`;

                    // Create a heatmap for the sequence
                    const heatmap = createHeatmap(sequence.Sequence, sequence.Variants);

                    // Add everything to the sequence list
                    seqList.appendChild(individual_id);
                    seqList.appendChild(heatmap);
                });
            } else {
                seqList.innerHTML = '<li>No results found.</li>';
            }
        }

        // Execute renderSequenceList function on page load to populate the list
        window.onload = function() {
            renderSequenceList();
        };
    </script>
    <style>
        .normal {
            color: black;
        }

        .variant {
            color: red;
        }
    </style>
</head>
<body>
    <h1>Enter Accession Number</h1>

    <!-- Search Input -->
    <input type="text" id="search" placeholder="Search by Accession number..." value="{{ query }}">
    <button onclick="searchSequence()">Search</button>

    <!-- Container for displaying the sequence list dynamically with JavaScript -->
    <ul id="sequence-list">
        <!-- This list will be dynamically populated by JavaScript -->
    </ul>

    <!-- Button to redirect to the upload CSV page -->
    <br><br>
    <a href="{% url 'upload_csv' %}">
        <button>Go to Upload CSV Page</button>
    </a>

</body>
</html>
